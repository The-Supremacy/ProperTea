apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# SIT is identical to local except for environment-specific paths.
# cert-manager and cloudnativepg have no env-specific paths and need no patches.
resources:
  - ../../local/apps

patches:
  - target:
      group: argoproj.io
      version: v1alpha1
      kind: Application
      name: argocd
    patch: |-
      - op: replace
        path: /spec/sources/0/helm/valueFiles/1
        value: $values/deploy/environments/sit/argocd/values.yaml

  - target:
      group: argoproj.io
      version: v1alpha1
      kind: Application
      name: argocd-config
    patch: |-
      - op: replace
        path: /spec/source/path
        value: deploy/environments/sit/argocd

  - target:
      group: argoproj.io
      version: v1alpha1
      kind: Application
      name: cert-manager-config
    patch: |-
      - op: replace
        path: /spec/source/path
        value: deploy/environments/sit/cert-manager

  - target:
      group: argoproj.io
      version: v1alpha1
      kind: Application
      name: gateway
    patch: |-
      - op: replace
        path: /spec/source/path
        value: deploy/environments/sit/gateway

  - target:
      group: argoproj.io
      version: v1alpha1
      kind: Application
      name: longhorn
    patch: |-
      - op: replace
        path: /spec/sources/0/helm/valueFiles/1
        value: $values/deploy/environments/sit/longhorn/values.yaml

  - target:
      group: argoproj.io
      version: v1alpha1
      kind: Application
      name: longhorn-config
    patch: |-
      - op: replace
        path: /spec/source/path
        value: deploy/environments/sit/longhorn

  - target:
      group: argoproj.io
      version: v1alpha1
      kind: Application
      name: zitadel-config
    patch: |-
      - op: replace
        path: /spec/source/path
        value: deploy/environments/sit/zitadel

  - target:
      group: argoproj.io
      version: v1alpha1
      kind: Application
      name: zitadel
    patch: |-
      - op: replace
        path: /spec/sources/0/helm/valueFiles/1
        value: $values/deploy/environments/sit/zitadel/values.yaml
