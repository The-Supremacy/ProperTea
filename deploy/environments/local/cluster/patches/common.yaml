# Common Talos machine config patch applied to ALL nodes (CP + workers).
# Configures: Cilium CNI (skip default), DNS, NTP, kubelet.

# Skip default Flannel CNI -- we install Cilium manually after bootstrap
cluster:
  network:
    cni:
      name: none
  proxy:
    disabled: true  # Cilium replaces kube-proxy

machine:
  network:
    nameservers:
      - 1.1.1.1
      - 8.8.8.8
  time:
    servers:
      - time.cloudflare.com
      - pool.ntp.org
  kubelet:
    extraArgs:
      rotate-server-certificates: "true"
    # Required by Longhorn: provides host directory access for volume data path.
    # See: https://longhorn.io/docs/1.8.1/advanced-resources/os-distro-specific/talos-linux-support/
    extraMounts:
      - destination: /var/lib/longhorn
        type: bind
        source: /var/lib/longhorn
        options:
          - bind
          - rshared
          - rw
