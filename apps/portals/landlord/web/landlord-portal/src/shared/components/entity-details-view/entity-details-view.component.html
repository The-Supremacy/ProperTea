<div class="flex h-full flex-col">
  <!-- Toolbar -->
  <div class="border-b bg-background px-4 py-3">
    <div role="toolbar" class="flex items-center justify-between gap-4">
      <!-- Left side: Back + Refresh + Title -->
      <div class="flex items-center gap-3 min-w-0 flex-1">
        @if (config().showBackButton) {
          <button
            type="button"
            hlmBtn
            variant="ghost"
            size="sm"
            (click)="goBack()"
            [attr.aria-label]="'common.back' | transloco">
            <app-icon name="arrow_back" [size]="20" />
          </button>
        }

        @if (config().showRefresh) {
          <button
            type="button"
            hlmBtn
            variant="ghost"
            size="sm"
            (click)="onRefresh()"
            [disabled]="loading()"
            [attr.aria-label]="'common.refresh' | transloco">
            <app-icon
              name="refresh"
              [size]="20"
              [class.animate-spin]="loading()" />
          </button>
        }

        <!-- Title (hidden on mobile) -->
        @if (!responsive.isMobile()) {
          <div class="min-w-0 flex-1">
            <h1 class="text-xl font-semibold truncate">
              {{ config().title }}
            </h1>
            @if (config().subtitle) {
              <p class="text-sm text-muted-foreground truncate">
                {{ config().subtitle }}
              </p>
            }
          </div>
        }
      </div>

      <!-- Right side: Primary Actions + Menu -->
      <div class="flex items-center gap-2">
        @if (responsive.isMobile()) {
          <!-- Mobile: All actions in menu -->
          <button
            type="button"
            hlmBtn
            variant="default"
            size="sm"
            [hlmDropdownMenuTrigger]="mobileActionsMenu"
            [attr.aria-label]="'common.actions' | transloco">
            <app-icon name="more_horiz" [size]="20" />
            <span class="sr-only">{{ 'common.actions' | transloco }}</span>
          </button>
        } @else {
          <!-- Desktop: Primary actions as buttons -->
          @for (action of config().primaryActions; track trackByLabel($index, action)) {
            <button
              type="button"
              hlmBtn
              [variant]="action.variant || 'default'"
              [disabled]="action.disabled"
              (click)="handleAction(action)">
              @if (action.icon) {
                <app-icon [name]="action.icon" [size]="16" />
              }
              <span>{{ action.label | transloco }}</span>
            </button>
          }

          <!-- Desktop: Overflow menu for secondary actions -->
          @if (config().secondaryActions && config().secondaryActions!.length > 0) {
            <button
              type="button"
              hlmBtn
              variant="ghost"
              size="sm"
              [hlmDropdownMenuTrigger]="actionsMenu"
              [attr.aria-label]="'common.more' | transloco">
              <app-icon name="more_vert" [size]="20" />
            </button>
          }
        }
      </div>
    </div>
  </div>

  <!-- Content Area -->
  <div class="flex-1 overflow-y-auto">
    <ng-content />
  </div>
</div>

<!-- Secondary Actions Menu (Desktop) -->
<ng-template #actionsMenu>
  <div hlmDropdownMenu class="min-w-50">
    @for (action of config().secondaryActions ?? []; track trackByLabel($index, action)) {
      @if (action.separatorBefore) {
        <div hlmDropdownMenuSeparator></div>
      }
      <button
        type="button"
        hlmDropdownMenuItem
        [disabled]="action.disabled"
        [variant]="action.variant === 'destructive' ? 'destructive' : 'default'"
        (click)="handleAction(action)">
        @if (action.icon) {
          <app-icon [name]="action.icon" [size]="16" />
        }
        <span>{{ action.label | transloco }}</span>
      </button>
    }
  </div>
</ng-template>

<!-- Mobile: All Actions Menu -->
<ng-template #mobileActionsMenu>
  <div hlmDropdownMenu class="min-w-50">
    @for (action of config().primaryActions ?? []; track trackByLabel($index, action)) {
      @if (action.separatorBefore) {
        <div hlmDropdownMenuSeparator></div>
      }
      <button
        type="button"
        hlmDropdownMenuItem
        [disabled]="action.disabled"
        [variant]="action.variant === 'destructive' ? 'destructive' : 'default'"
        (click)="handleAction(action)">
        @if (action.icon) {
          <app-icon [name]="action.icon" [size]="16" />
        }
        <span>{{ action.label | transloco }}</span>
      </button>
    }

    @if (config().secondaryActions && config().secondaryActions!.length > 0) {
      <div hlmDropdownMenuSeparator></div>
      @for (action of config().secondaryActions ?? []; track trackByLabel($index, action)) {
        <button
          type="button"
          hlmDropdownMenuItem
          [disabled]="action.disabled"
          [variant]="action.variant === 'destructive' ? 'destructive' : 'default'"
          (click)="handleAction(action)">
          @if (action.icon) {
            <app-icon [name]="action.icon" [size]="16" />
          }
          <span>{{ action.label | transloco }}</span>
        </button>
      }
    }
  </div>
</ng-template>
