<hlm-sheet side="right" [state]="open() ? 'open' : 'closed'" (closed)="onSheetClosed()">
  <hlm-sheet-content *hlmSheetPortal="let ctx" class="sm:max-w-md flex flex-col">
    <hlm-sheet-header>
      <h3 hlmSheetTitle>{{ 'companies.newCompany' | transloco }}</h3>
      <p hlmSheetDescription>{{ 'companies.createHint' | transloco }}</p>
    </hlm-sheet-header>

    <!-- Body -->
    <form [formGroup]="form" (ngSubmit)="submit()" class="flex min-h-0 flex-1 flex-col">
      <div class="flex-1 space-y-6 overflow-y-auto px-4">

        <!-- Code Field -->
        <hlm-form-field>
          <label hlmLabel for="company-code">
            {{ 'companies.code' | transloco }}
            <span class="text-destructive">*</span>
          </label>

          <input
            hlmInput
            id="company-code"
            type="text"
            formControlName="code"
            class="w-full font-mono uppercase"
            [placeholder]="'companies.codePlaceholder' | transloco"
            required
            autocomplete="off" />

          <!-- Validation Errors -->
          @if (codeControl().invalid && codeControl().touched) {
            @if (codeControl().hasError('required')) {
              <hlm-error>{{ 'companies.codeRequired' | transloco }}</hlm-error>
            }
            @if (codeControl().hasError('minlength')) {
              <hlm-error>{{ 'companies.codeTooShort' | transloco }}</hlm-error>
            }
            @if (codeControl().hasError('maxlength')) {
              <hlm-error>{{ 'companies.codeTooLong' | transloco }}</hlm-error>
            }
            @if (codeControl().hasError('codeTaken')) {
              <hlm-error>{{ 'companies.codeTaken' | transloco }}</hlm-error>
            }
          }
        </hlm-form-field>

        <!-- Checking state -->
        @if (codeControl().pending) {
          <p class="flex items-center gap-1 text-sm text-muted-foreground">
            <app-icon name="hourglass_empty" [size]="14" />
            {{ 'companies.checkingCode' | transloco }}
          </p>
        }

        <!-- Success state -->
        @if (codeControl().valid && codeControl().touched && !codeControl().pending) {
          <p class="flex items-center gap-1 text-sm text-green-600">
            <app-icon name="check_circle" [size]="14" />
            {{ 'companies.codeAvailable' | transloco }}
          </p>
        }

        <!-- Name Field -->
        <hlm-form-field>
          <label hlmLabel for="company-name">
            {{ 'companies.name' | transloco }}
            <span class="text-destructive">*</span>
          </label>

          <input
            hlmInput
            id="company-name"
            type="text"
            formControlName="name"
            class="w-full"
            [placeholder]="'companies.namePlaceholder' | transloco"
            required
            autocomplete="organization" />

          <!-- Validation Errors -->
          @if (nameControl().invalid && nameControl().touched) {
            @if (nameControl().hasError('required')) {
              <hlm-error>{{ 'companies.nameRequired' | transloco }}</hlm-error>
            }
            @if (nameControl().hasError('minlength')) {
              <hlm-error>{{ 'companies.nameTooShort' | transloco }}</hlm-error>
            }
            @if (nameControl().hasError('maxlength')) {
              <hlm-error>{{ 'companies.nameTooLong' | transloco }}</hlm-error>
            }
            @if (nameControl().hasError('nameTaken')) {
              <hlm-error>{{ 'companies.nameTaken' | transloco }}</hlm-error>
            }
          }
        </hlm-form-field>

        <!-- Checking state -->
        @if (nameControl().pending) {
          <p class="flex items-center gap-1 text-sm text-muted-foreground">
            <app-icon name="hourglass_empty" [size]="14" />
            {{ 'companies.checkingName' | transloco }}
          </p>
        }

        <!-- Success state -->
        @if (nameControl().valid && nameControl().touched && !nameControl().pending) {
          <p class="flex items-center gap-1 text-sm text-green-600">
            <app-icon name="check_circle" [size]="14" />
            {{ 'companies.nameAvailable' | transloco }}
          </p>
        }
      </div>

      <hlm-sheet-footer>
        <button
          type="button"
          hlmBtn
          variant="outline"
          class="flex-1"
          hlmSheetClose
          [disabled]="isSubmitting()">
          {{ 'common.cancel' | transloco }}
        </button>

        <button
          type="submit"
          hlmBtn
          class="flex-1"
          [disabled]="!canSubmit()">
          @if (isSubmitting()) {
            <hlm-spinner size="sm" />
          }
          {{ 'common.create' | transloco }}
        </button>
      </hlm-sheet-footer>
    </form>
  </hlm-sheet-content>
</hlm-sheet>
