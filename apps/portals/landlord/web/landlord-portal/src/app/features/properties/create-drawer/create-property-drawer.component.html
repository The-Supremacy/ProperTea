<!-- Backdrop -->
@if (open()) {
  <div
    class="fixed inset-0 z-50 bg-background/80 backdrop-blur-[2px] transition-opacity duration-300"
    [class.opacity-0]="!open()"
    [class.opacity-100]="open()"
    (click)="close()"></div>

  <!-- Drawer Content -->
  <div
    class="fixed inset-y-0 right-0 z-50 w-full border-l bg-background text-foreground shadow-lg transition-transform duration-300 sm:max-w-md"
    [class.translate-x-full]="!open()"
    [class.translate-x-0]="open()">
    <!-- Header -->
    <div class="flex items-center justify-between border-b px-6 py-4">
      <h2 class="text-lg font-semibold">
        {{ 'properties.newProperty' | transloco }}
      </h2>
      <button
        type="button"
        class="rounded-md p-2 text-muted-foreground transition-colors hover:bg-accent hover:text-accent-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"
        [attr.aria-label]="'common.close' | transloco"
        (click)="close()">
        <app-icon name="close" [size]="20" />
      </button>
    </div>

    <!-- Body -->
    <form [formGroup]="form" (ngSubmit)="submit()" class="flex h-[calc(100%-8rem)] flex-col">
      <div class="flex-1 space-y-6 overflow-y-auto px-6 py-6">
        <!-- Help text -->
        <p class="text-sm text-muted-foreground">
          {{ 'properties.createHint' | transloco }}
        </p>

        <!-- Company Field -->
        <div class="space-y-2">
          <label for="property-company" class="text-sm font-medium">
            {{ 'properties.company' | transloco }}
            <span class="text-destructive">*</span>
          </label>

          <app-select
            [value]="form.controls.companyId.value"
            [options]="companyOptions()"
            [placeholder]="'properties.selectCompany'"
            (valueChange)="onCompanyChange($event)" />

          @if (form.controls.companyId.invalid && form.controls.companyId.touched) {
            @if (form.controls.companyId.hasError('required')) {
              <app-validation-error
                [message]="'properties.companyRequired' | transloco"
                [showIcon]="true" />
            }
          }
        </div>

        <!-- Code Field -->
        <div class="space-y-2">
          <label for="property-code" class="text-sm font-medium">
            {{ 'properties.code' | transloco }}
            <span class="text-destructive">*</span>
          </label>

          <input
            appTextInput
            id="property-code"
            type="text"
            formControlName="code"
            [placeholder]="'properties.codePlaceholder' | transloco"
            [variant]="
              form.controls.code.invalid && form.controls.code.touched
                ? 'error'
                : 'default'
            "
            required />

          @if (form.controls.code.invalid && form.controls.code.touched) {
            @if (form.controls.code.hasError('required')) {
              <app-validation-error
                [message]="'properties.codeRequired' | transloco"
                [showIcon]="true" />
            }
            @if (form.controls.code.hasError('maxlength')) {
              <app-validation-error
                [message]="'properties.codeTooLong' | transloco"
                [showIcon]="true" />
            }
          }
        </div>

        <!-- Name Field -->
        <div class="space-y-2">
          <label for="property-name" class="text-sm font-medium">
            {{ 'properties.name' | transloco }}
            <span class="text-destructive">*</span>
          </label>

          <input
            appTextInput
            id="property-name"
            type="text"
            formControlName="name"
            [placeholder]="'properties.namePlaceholder' | transloco"
            [variant]="
              form.controls.name.invalid && form.controls.name.touched
                ? 'error'
                : 'default'
            "
            required />

          @if (form.controls.name.invalid && form.controls.name.touched) {
            @if (form.controls.name.hasError('required')) {
              <app-validation-error
                [message]="'properties.nameRequired' | transloco"
                [showIcon]="true" />
            }
            @if (form.controls.name.hasError('maxlength')) {
              <app-validation-error
                [message]="'properties.nameTooLong' | transloco"
                [showIcon]="true" />
            }
          }
        </div>

        <!-- Address Field -->
        <div class="space-y-2">
          <label for="property-address" class="text-sm font-medium">
            {{ 'properties.address' | transloco }}
            <span class="text-destructive">*</span>
          </label>

          <input
            appTextInput
            id="property-address"
            type="text"
            formControlName="address"
            [placeholder]="'properties.addressPlaceholder' | transloco"
            [variant]="
              form.controls.address.invalid && form.controls.address.touched
                ? 'error'
                : 'default'
            "
            required />

          @if (form.controls.address.invalid && form.controls.address.touched) {
            @if (form.controls.address.hasError('required')) {
              <app-validation-error
                [message]="'properties.addressRequired' | transloco"
                [showIcon]="true" />
            }
          }
        </div>

        <!-- Square Footage Field -->
        <div class="space-y-2">
          <label for="property-sqft" class="text-sm font-medium">
            {{ 'properties.squareFootage' | transloco }}
          </label>

          <input
            appTextInput
            id="property-sqft"
            type="number"
            formControlName="squareFootage"
            [placeholder]="'properties.squareFootagePlaceholder' | transloco"
            min="0" />
        </div>
      </div>

      <!-- Footer -->
      <div class="flex gap-2 border-t p-4">
        <button
          type="button"
          appBtn
          variant="outline"
          class="flex-1"
          [disabled]="isSubmitting()"
          (click)="close()">
          {{ 'common.cancel' | transloco }}
        </button>

        <button
          type="submit"
          appBtn
          class="flex-1"
          [disabled]="!canSubmit()">
          @if (isSubmitting()) {
            <app-spinner size="sm" />
          }
          {{ 'common.create' | transloco }}
        </button>
      </div>
    </form>
  </div>
}
