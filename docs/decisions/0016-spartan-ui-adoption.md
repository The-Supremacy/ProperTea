# ADR 0016: Adopt Spartan UI Component Library

**Status**: Accepted
**Date**: 2026-02-18
**Deciders**: Team

## Context

ADR 0012 chose a "Pure Angular Stack" (Angular Aria + CDK + Material + CVA) over Spartan and custom wrappers. After several weeks of building features against that architecture, three structural problems have emerged:

### 1. The "no wrappers" principle failed in practice

ADR 0012 mandates "use Angular Aria directly in templates, NO wrappers." In practice, we built `SelectComponent` (130 lines) and `AutocompleteComponent` (125 lines) in `shared/components/` - both wrap Aria Combobox + Listbox + CDK Overlay with Tailwind styling, loading states, and UX behaviors. These are infrastructure components, not business components. The codebase naturally gravitates toward composed, styled primitives.

### 2. Material scope exceeds original intent

ADR 0012 allows Material for "Datepicker, Slider only." Current Material usage: Dialog (`ConfirmDialogComponent`, `DialogService`), Snackbar (`ToastService`), and Icon (`IconComponent`). Zero datepicker or slider usage exists. The components we actually needed Material for are not the ones the ADR anticipated.

### 3. Material + Tailwind styling conflict

Material components use their own theming system (CSS custom properties like `--mat-sys-*`, `--mat-mdc-*`). We already maintain bridge variables in `styles.css` (`--mat-sys-on-surface: var(--color-foreground)`) and override Material internals (`.mat-mdc-dialog-surface { background-color: transparent !important }`). Every Material component requires fighting its built-in styling to match Tailwind's design tokens.

### Re-evaluating original Spartan objections

| ADR 0012 Objection | Current Reality |
|---|---|
| 30KB+ wrapper overhead | Helm code is copied into the project (owned source), not a runtime wrapper dependency. Brain is the only npm package, comparable in size to `@angular/aria` |
| Proxy Hell | Spartan builds on CDK directly, not on Aria. It does not wrap Material at all. This is different from creating `<app-menu>` that proxies `ngMenu` |
| Still need to learn Aria underneath | We need to learn the underlying primitives regardless. CDK is more stable and better documented than Aria |
| Community maintenance risk | Valid concern. Mitigated: helm code survives maintainer absence (it is our code), brain is a thin CDK wrapper (replaceable), project has 2.4k+ GitHub stars and active development |

### Shadcn mental model correction

The original evaluation compared Spartan to "headless directives on HTML tags" (like Aria). Shadcn/Spartan is structurally different: the headless layer (Brain/Radix) provides accessibility primitives, while the component layer (Helm/Shadcn components) provides pre-styled, opinionated building blocks that you own and customize. The value proposition is not headlessness but ownership without starting from scratch.

### Why not PrimeNG

- Tailwind integration is a theming layer on top of PrimeNG's own component architecture, not Tailwind-native
- Signal-first claims are marketing ahead of implementation reality
- Hidden magic in forms, overlays, and internals creates debugging walls
- Poor fit for a codebase that values explicitness and code ownership

## Decision

Replace the Pure Angular Stack (ADR 0012) with **Spartan UI** as the primary component library.

### Architecture: Brain + Helm

```
┌──────────────────────────────────────────────────────────────┐
│ Layer 3: Business Components                                 │
│ Location: /features/**/*.component.ts                        │
│ Examples: property-table, tenant-selector, role-badge        │
│ Rule: Only create when adding domain logic (10+ usages)      │
│ Threshold: ALL of: 10+ usages, business logic, stable API    │
└──────────────────────────────────────────────────────────────┘
                              ▲
┌──────────────────────────────────────────────────────────────┐
│ Layer 2: Extended Primitives                                 │
│ Location: /shared/components/                                │
│ Examples: entity-list-view (TanStack Table), custom CVA      │
│ Rule: Domain-specific compositions of Layer 1 primitives     │
└──────────────────────────────────────────────────────────────┘
                              ▲
┌──────────────────────────────────────────────────────────────┐
│ Layer 1: Spartan Primitives (Brain + Helm)                   │
│ Location: /shared/components/ui/ (generated by CLI)          │
│ Examples: HlmButton, HlmDialog, HlmSelect, HlmTabs         │
│ Rule: Owned Tailwind-styled components. Modify directly.     │
│ Source: brain via npm, helm copied into project               │
└──────────────────────────────────────────────────────────────┘
```

### Technology Stack

| Concern | Library | Relationship |
|---|---|---|
| Accessible primitives | `@spartan-ng/brain` | npm dependency (maintained) |
| Styled components | Spartan Helm (copied source) | Owned code in `shared/components/ui/` |
| Utility components | `@angular/cdk` | Retained: Overlay, Layout, DragDrop, VirtualScroll |
| Data tables | `@tanstack/angular-table` | Retained, integrates with Spartan Table |
| Primitive styling | `class-variance-authority` | Retained, used by Helm components |
| Class composition | `clsx` + `tailwind-merge` | Retained, used by Helm `hlm()` utility |
| Design system | Tailwind CSS v4 | Master theme, no competing theming system |
| Icons | `lucide-angular` | Retained (evaluate `ng-icons` during migration) |
| Toast notifications | `ngx-sonner` (via Spartan Sonner) | Replaces Material Snackbar |

### What gets removed

| Package | Reason |
|---|---|
| `@angular/material` | Fully replaced by Spartan (Dialog, Snackbar, Icon) |
| `@angular/aria` | Replaced by Spartan Brain (which uses CDK directly) |
| `@angular/animations` | Required by Material; evaluate if still needed post-removal |

### What gets retained

| Package | Why |
|---|---|
| `@angular/cdk` | Spartan depends on it; also used for Overlay, Layout, BreakpointObserver |
| `@tanstack/angular-table` | Spartan Data Table integrates with it; no replacement needed |
| `class-variance-authority` | Used by Spartan Helm; already in our stack |
| `clsx` + `tailwind-merge` | Used by Spartan's `hlm()` utility; already in our stack |
| `embla-carousel-angular` | Spartan Carousel uses it; already installed |

### Component Mapping

| Current Component | Current Source | Spartan Replacement |
|---|---|---|
| `ButtonDirective` (`[appBtn]`) | CVA directive | `HlmButton` directive |
| `BadgeDirective` (`[appBadge]`) | CVA directive | `HlmBadge` directive |
| `SelectComponent` | Aria Combobox + Listbox + CDK Overlay | Spartan Select |
| `AutocompleteComponent` | Aria Combobox + Listbox + CDK Overlay | Spartan Autocomplete / Combobox |
| `ConfirmDialogComponent` | Material Dialog | Spartan Alert Dialog |
| `DialogService` | Material Dialog | Spartan Dialog (brain) |
| `ToastService` | Material Snackbar | Spartan Sonner |
| `IconComponent` | Material Icon | Spartan Icon or keep `lucide-angular` |
| `SpinnerComponent` | Custom SVG | Spartan Spinner |
| Tabs (Aria) | `@angular/aria/tabs` | Spartan Tabs |
| Accordion (Aria) | `@angular/aria/accordion` | Spartan Accordion |
| Menu (Aria) | `@angular/aria/menu` | Spartan Dropdown Menu |
| Toolbar (Aria) | `@angular/aria/toolbar` | Tailwind flex layout (no Spartan equivalent needed) |
| Drawer (placeholder) | Not implemented | Spartan Sheet |
| CSS `.card` / `.input` classes | `styles.css` @layer | Spartan Card / Input components |

### Spartan components gained (not yet built, needed per ADR 0011)

Calendar, Date Picker, Checkbox, Radio Group, Switch, Tooltip, Progress, Popover, Slider, Form Field, Label, Separator, Skeleton, Scroll Area, Pagination, Sidebar, Breadcrumb, Navigation Menu.

### Anti-Patterns (unchanged from ADR 0012)

- Do NOT wrap Spartan components in pass-through wrappers
- Do NOT create `<app-button>` that just proxies `hlmBtn`
- Only create business components when: 10+ usages AND adds domain logic AND reduces duplication AND stable API
- Import Spartan directives/components directly in feature component imports arrays

### CSS Integration

Replace Material theme bridge with Spartan preset:

```css
/* styles.css - BEFORE */
@import "tailwindcss";
@import '@angular/cdk/overlay-prebuilt.css';
/* ... Material bridge variables, overrides ... */

/* styles.css - AFTER */
@import "tailwindcss";
@import "@spartan-ng/brain/hlm-tailwind-preset.css";
/* Spartan preset includes: tw-animate-css, @angular/cdk/overlay-prebuilt.css */
/* Theme variables via Spartan CLI or manual CSS custom properties */
```

## Consequences

### Positive

- **Tailwind-native throughout**: No Material theming conflicts. One styling system, one set of design tokens
- **Owned components**: Helm source is in our codebase. Full control over styling without fighting a theming API
- **Faster velocity**: Pre-built components for Select, Dialog, Sheet, Tabs, Accordion, etc. eliminate the infrastructure work we were doing anyway
- **Aligned tooling**: CVA, clsx, tailwind-merge, Tailwind v4 are already in our stack. Spartan uses the exact same tools
- **Accessibility maintained**: Brain handles ARIA attributes, keyboard navigation, focus management (same guarantees as Angular Aria)
- **Smaller dependency surface**: Remove Material + Aria (two large packages with their own theming systems), add Brain (one focused package)
- **Future components for free**: Calendar, DatePicker, Sidebar, etc. available when needed without hand-rolling

### Negative

- **Migration effort**: ~15 shared components and ~7 feature files need updating (bounded: 4 features, early-stage codebase)
- **Community dependency**: Brain package depends on Spartan maintainers (mitigated: helm is owned, brain is thin CDK wrapper)
- **No official Angular backing**: Unlike Material/Aria, Spartan is community-maintained
- **Form component marked "soon"**: Reactive Forms work directly with Input/Label/FormField, but a unified Form component is pending

### Risks / Mitigation

- **Spartan project abandonment** -> Helm code is fully owned (lives in our repo). Brain is a thin CDK wrapper; worst case, we maintain the ~2KB of ARIA orchestration ourselves or fork. CDK itself is officially maintained.
- **Breaking changes in Brain** -> Pin versions, update deliberately. Helm code is decoupled - brain API changes don't cascade to our templates.
- **Migration regressions** -> Migrate one component at a time. Validate each feature's list + details view before proceeding.

## Supersedes

- ADR 0012 (Pure Angular Component Strategy)
